openapi: 3.0.3
info:
  title: Causes API
  description: API for managing charitable causes, including creation, retrieval, and organization-specific cause management
  version: 1.0.0
  contact:
    name: API Support
    email: api-support@crecent-change.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000/api/v1
    description: Development server
  - url: https://api.crecent-change.com/api/v1
    description: Production server

tags:
  - name: Causes
    description: Operations for managing charitable causes

paths:
  /cause:
    get:
      tags:
        - Causes
      summary: Get all causes with pagination and filtering
      description: Retrieves causes with optional filtering by name, organization, and pagination
      operationId: getCauses
      parameters:
        - name: name
          in: query
          description: Filter by cause name
          schema:
            type: string
          example: "Ocean Cleanup"
        - name: organization
          in: query
          description: Filter by organization ID
          schema:
            type: string
          example: "64f1b2c3d4e5f6789012345"
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [name, createdAt, updatedAt]
            default: "createdAt"
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: "desc"
      responses:
        '200':
          description: Causes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CausesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Causes
      summary: Create a new cause
      description: Creates a new cause. Organizations can create causes for themselves; admins can create causes for any organization
      operationId: createCause
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCauseRequest'
            examples:
              basic:
                summary: Basic cause creation
                value:
                  name: "Ocean Cleanup Initiative"
                  notes: "Supporting ocean conservation efforts"
              withOrganization:
                summary: Admin creating cause for specific org
                value:
                  name: "Education Fund"
                  notes: "Supporting educational programs"
                  organization: "64f1b2c3d4e5f6789012345"
      responses:
        '201':
          description: Cause created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CauseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /cause/names:
    get:
      tags:
        - Causes
      summary: Get unique cause names
      description: Retrieves all unique cause names (public endpoint for dropdowns)
      operationId: getCauseNames
      responses:
        '200':
          description: Cause names retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CauseNamesResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /cause/organization/{organizationId}:
    get:
      tags:
        - Causes
      summary: Get causes by organization
      description: Retrieves all causes belonging to a specific organization (public endpoint)
      operationId: getCausesByOrganization
      parameters:
        - name: organizationId
          in: path
          required: true
          schema:
            type: string
          description: ID of the organization
          example: "64f1b2c3d4e5f6789012345"
      responses:
        '200':
          description: Organization causes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CausesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /cause/{id}:
    get:
      tags:
        - Causes
      summary: Get cause by ID
      description: Retrieves a specific cause by its ID (public endpoint)
      operationId: getCauseById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID of the cause
          example: "64f1b2c3d4e5f6789012346"
      responses:
        '200':
          description: Cause retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CauseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    patch:
      tags:
        - Causes
      summary: Update cause
      description: Updates an existing cause. Organizations can only update their own causes
      operationId: updateCause
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID of the cause to update
          example: "64f1b2c3d4e5f6789012346"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCauseRequest'
            examples:
              basic:
                summary: Basic cause update
                value:
                  name: "Updated Ocean Cleanup Initiative"
                  notes: "Supporting ocean conservation efforts - Updated description"
      responses:
        '200':
          description: Cause updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CauseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Causes
      summary: Delete cause
      description: Deletes a cause. Organizations can only delete their own causes
      operationId: deleteCause
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID of the cause to delete
          example: "64f1b2c3d4e5f6789012346"
      responses:
        '200':
          description: Cause deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteCauseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Request Schemas
    CreateCauseRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 100
          description: Name of the cause
          example: "Ocean Cleanup Initiative"
        notes:
          type: string
          maxLength: 500
          description: Description or notes about the cause
          example: "Supporting ocean conservation efforts"
        organization:
          type: string
          description: Organization ID (optional, auto-filled for organization users)
          example: "64f1b2c3d4e5f6789012345"

    UpdateCauseRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
          description: Updated name of the cause
          example: "Updated Ocean Cleanup Initiative"
        notes:
          type: string
          maxLength: 500
          description: Updated description of the cause
          example: "Supporting ocean conservation efforts - Updated description"

    # Response Schemas
    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
        data:
          type: object
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    PaginationMeta:
      type: object
      properties:
        limit:
          type: integer
          description: Number of items per page
        page:
          type: integer
          description: Current page number
        total:
          type: integer
          description: Total number of items
        totalPage:
          type: integer
          description: Total number of pages

    Cause:
      type: object
      properties:
        _id:
          type: string
          example: "64f1b2c3d4e5f6789012346"
        name:
          type: string
          example: "Ocean Cleanup Initiative"
        notes:
          type: string
          example: "Supporting ocean conservation efforts"
        organization:
          $ref: '#/components/schemas/OrganizationInfo'
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2023-09-20T15:30:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-09-20T15:30:00.000Z"

    CauseResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Cause retrieved successfully"
        data:
          $ref: '#/components/schemas/Cause'

    CausesResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Causes retrieved successfully"
        data:
          type: array
          items:
            $ref: '#/components/schemas/Cause'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CauseNamesResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Cause names retrieved successfully"
        data:
          type: array
          items:
            type: string
          example: ["Ocean Cleanup Initiative", "Education Fund", "Food Security Project"]

    DeleteCauseResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Cause deleted successfully"
        data:
          type: object
          properties:
            deleted:
              type: boolean
              example: true
            id:
              type: string
              example: "64f1b2c3d4e5f6789012346"

    # Reference Schemas
    OrganizationInfo:
      type: object
      properties:
        _id:
          type: string
          example: "64f1b2c3d4e5f6789012345"
        name:
          type: string
          example: "Save the Ocean Foundation"
        email:
          type: string
          format: email
          example: "info@saveocean.org"

    # Error Schemas
    ErrorDetail:
      type: object
      properties:
        field:
          type: string
        message:
          type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
        data:
          type: null
          example: null
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ErrorDetail'

  responses:
    BadRequest:
      description: Bad request due to validation errors or invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            validationError:
              summary: Validation error
              value:
                success: false
                message: "Validation failed"
                data: null
                errors:
                  - field: "name"
                    message: "Name is required!"

    Unauthorized:
      description: Authentication required or invalid credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Authentication required"
            data: null
            errors: []

    Forbidden:
      description: User doesn't have permission to perform this action
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "You are not authorized to update this cause!"
            data: null
            errors: []

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Cause not found!"
            data: null
            errors: []

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Internal server error"
            data: null
            errors: []
