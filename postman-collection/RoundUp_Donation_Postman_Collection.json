{
	"info": {
		"_postman_id": "443e4d6b-5a76-4d72-98fc-8d9c6ed8f4a9",
		"name": "RoundUp Donation Module API",
		"description": "Complete Postman collection for Crescent Change RoundUp donation system. This collection covers all endpoints for user RoundUp management, automated processing, and admin testing.\n\n## Key Features:\n- User RoundUp configuration and management\n- Transaction synchronization (data collection phase)\n- Automated donation processing via cron jobs\n- Manual donation triggers\n- Charity management with 30-day switching rule\n- Admin testing and dashboard endpoints\n\n## Authentication:\n- All endpoints require JWT token\n- CLIENT Role: User endpoints\n- ADMIN Role: Admin testing endpoints\n\n## Testing Flow:\n1. Create bank connection → 2. Save RoundUp consent → 3. Sync transactions → 4. Trigger manual processing → 5. Check dashboard\n\n## Important Notes:\n- Transaction sync (step 3) only collects data\n- Donation processing happens automatically every 4 hours via cron job\n- Manual testing available via `/test-cron-processing` endpoint",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "RoundUp User Endpoints",
			"item": [
				{
					"name": "Save Plaid Consent - Create RoundUp Configuration",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store roundUp ID for later tests",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data._id) {",
									"        pm.collectionVariables.set('roundUpId', response.data._id);",
									"        console.log('Stored roundUpId:', response.data._id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"bankConnectionId\": \"{{bankConnectionId}}\",\n  \"organizationId\": \"{{organizationId}}\",\n  \"causeId\": \"{{causeId}}\",\n  \"monthlyThreshold\": 3,\n  \"specialMessage\": \"My first RoundUp setup\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/consent/save",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"consent",
								"save"
							]
						},
						"description": "Create a new RoundUp configuration. This is the first step after establishing a bank connection.\n\n**Required:**\n- bankConnectionId: From BankConnection creation\n- organizationId: Target charity organization\n- causeId: Specific cause within organization\n- monthlyThreshold: Amount to trigger donations (min $3)\n\n**Response:** Creates RoundUp configuration with 'active' status"
					},
					"response": []
				},
				{
					"name": "Sync Transactions - Data Collection Only",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cursor\": \"\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/transactions/sync/{{bankConnectionId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"transactions",
								"sync",
								"{{bankConnectionId}}"
							]
						},
						"description": "Fetch transactions from Plaid API and store them.\n\n**Important:** This endpoint only SYNCS transaction data - it does NOT process RoundUp donations. Processing happens automatically via cron job every 4 hours or manually via test endpoint.\n\n**Parameters:**\n- cursor: Optional pagination cursor from previous sync\n\n**Response:** Returns fetched transaction count and pagination info. RoundUp processing noted as automatic."
					},
					"response": []
				},
				{
					"name": "Manual Monthly Donation Trigger",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"roundUpId\": \"{{roundUpId}}\",\n  \"specialMessage\": \"Manual test donation via API\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/process-monthly-donation",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"process-monthly-donation"
							]
						},
						"description": "Manually trigger donation processing before threshold reached.\n\n**Use Cases:**\n- Testing donation flow\n- Early donation before 4-hour cron\n- Force donation of accumulated roundups\n\n**Required:**\n- roundUpId: From saved RoundUp configuration\n- specialMessage: Optional custom message\n\n**Process:** Creates Stripe payment intent → Updates transaction status → Webhook completes donation"
					},
					"response": []
				},
				{
					"name": "Get User Dashboard",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/dashboard",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"dashboard"
							]
						},
						"description": "Get comprehensive RoundUp dashboard data for the authenticated user.\n\n**Response Includes:**\n- RoundUp configuration details\n- Transaction sync status\n- Accumulated RoundUp totals\n- Donation history\n- Processing status (pending/processing/completed)\n- Monthly threshold tracking\n\n**Timing:** Use this to check results after transaction sync and processing."
					},
					"response": []
				},
				{
					"name": "Get Transaction Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/transaction/{{transactionId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"transaction",
								"{{transactionId}}"
							]
						},
						"description": "Get detailed information about a specific RoundUp transaction.\n\n**Parameters:**\n- transactionId: ID from RoundUpTransaction collection\n\n**Response Details:**\n- Original transaction amount\n- Calculated RoundUp amount\n- Processing status\n- Payment intent ID\n- Donation linkage\n\n**Use Case:** Debug specific transaction processing or webhook issues."
					},
					"response": []
				},
				{
					"name": "Switch Charity (30-Day Rule)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"roundUpId\": \"{{roundUpId}}\",\n  \"newOrganizationId\": \"{{newOrganizationId}}\",\n  \"newCauseId\": \"{{newCauseId}}\",\n  \"reason\": \"I want to support a different cause\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/charity/switch",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"charity",
								"switch"
							]
						},
						"description": "Switch charity organization and cause with 30-day validation.\n\n**Business Rule:** Users can only change charities once every 30 days.\n\n**Required:**\n- roundUpId: Current configuration\n- newOrganizationId: Target organization\n- newCauseId: Must belong to new organization\n- reason: Optional change reason\n\n**Response:**\n- Success: Updated configuration with new charity\n- Failure: Days remaining until next allowed change\n\n**Validation:** Ensures cause belongs to specified organization."
					},
					"response": []
				},
				{
					"name": "Resume Paused RoundUp",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"roundUpId\": \"{{roundUpId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/resume",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"resume"
							]
						},
						"description": "Resume a previously paused RoundUp configuration.\n\n**Use Cases:**\n- User manually paused and wants to restart\n- Automatic pause due to failed payments\n- System maintenance periods\n\n**Required:**\n- roundUpId: Paused configuration ID\n\n**Process:**\n- Changes status from 'paused' to 'active'\n- Re-enables automatic processing\n- Retains all previous settings and history\n\n**Note:** Does not trigger immediate processing - follows normal cron schedule."
					},
					"response": []
				},
				{
					"name": "Revoke Consent and Disconnect",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/consent/revoke/{{bankConnectionId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"consent",
								"revoke",
								"{{bankConnectionId}}"
							]
						},
						"description": "Revoke RoundUp consent and disconnect from bank.\n\n**Actions Performed:**\n- Deactivates RoundUp configuration\n- Disconnects Plaid bank connection\n- Preserves transaction history\n- Stops future processing\n\n**Parameters:**\n- bankConnectionId: Connection to revoke\n\n**Security:** Fully removes access to bank data while maintaining donation records.\n\n**Note:** This is irreversible - user must create new bank connection to resume RoundUps."
					},
					"response": []
				}
			],
			"description": "User-facing endpoints for RoundUp donation management. All require CLIENT role authentication and valid JWT tokens."
		},
		{
			"name": "Admin Testing Endpoints",
			"item": [
				{
					"name": "Manual Cron Processing Test",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{adminJwtToken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": \"{{testUserId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/test-cron-processing",
							"host": [
								"{{baseUrl}}"
							]
						],
						"description": "Manually trigger the 4-hour RoundUp processing cron job for testing.\n\n**Authentication:** Requires ADMIN role JWT token.\n\n**Parameters:**\n- userId: Optional - Test specific user, omit for all users\n\n**Process:**\n1. Syncs transactions from Plaid (like sync endpoint)\n2. Analyzes RoundUp opportunities\n3. Creates RoundUp transaction entries\n4. Processes donations via Stripe webhooks\n5. Updates transaction statuses\n\n**Response:**\n- Processing summary per user\n- Success/failure counts\n- Total amounts processed\n- Error details if any\n\n**Console Output:** Detailed logging of each processing step.\n\n**Note:** This bypasses the 4-hour schedule for immediate testing."
					},
					"response": []
				},
				{
					"name": "Get Admin Dashboard",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{adminJwtToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/secure-roundup/admin/dashboard",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"secure-roundup",
								"admin",
								"dashboard"
							]
						},
						"description": "Get system-wide RoundUp statistics and admin dashboard.\n\n**Authentication:** Requires ADMIN role JWT token.\n\n**Response Includes:**\n- Total active RoundUp configurations\n- System-wide transaction counts\n- Monthly donation totals\n- Processing statistics\n- Error rates and failures\n- User engagement metrics\n\n**Analytics:**\n- Donation volume by organization\n- Processing success rates\n- Average RoundUp amounts\n- Active vs paused configurations\n\n**Use Cases:**\n- System health monitoring\n- Performance optimization\n- User support troubleshooting\n- Business intelligence"
					},
					"response": []
				}
			],
			"description": "Admin-only endpoints for testing and monitoring the RoundUp system. Requires ADMIN role authentication."
		},
		{
			"name": "Setup & Configuration",
			"item": [
				{
					"name": "Login - Get Client JWT Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "Authenticate as CLIENT user to get JWT token for RoundUp endpoints.\n\n**Response:**\n- accessToken: JWT token for API calls\n- refreshToken: For token renewal\n- user: User profile details\n\n**Event:** Automatically stores jwtToken in collection variables for subsequent requests."
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Store JWT tokens from successful login",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.accessToken) {",
									"        pm.collectionVariables.set('jwtToken', response.data.accessToken);",
									"        pm.collectionVariables.set('refreshToken', response.data.refreshToken);",
									"        console.log('Stored JWT tokens for CLIENT role');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Login - Get Admin JWT Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"admin123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "Authenticate as ADMIN user to get JWT token for admin testing endpoints.",
						"event": [
							{
								"listen": "test",
								"script": {
									"exec": [
										"// Store admin JWT tokens from successful login",
										"if (pm.response.code === 200) {",
										"    const response = pm.response.json();",
										"    if (response.data && response.data.accessToken) {",
										"        pm.collectionVariables.set('adminJwtToken', response.data.accessToken);",
										"        console.log('Stored JWT tokens for ADMIN role');",
										"    }",
										"}"
									],
									"type": "text/javascript"
								}
							}
						]
					},
					"response": []
				}
			],
			"description": "Authentication and setup endpoints for testing RoundUp functionality."
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "jwtToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "adminJwtToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "bankConnectionId",
			"value": "YOUR_BANK_CONNECTION_ID",
			"type": "string"
		},
		{
			"key": "organizationId",
			"value": "YOUR_ORGANIZATION_ID",
			"type": "string"
		},
		{
			"key": "causeId",
			"value": "YOUR_CAUSE_ID",
			"type": "string"
		},
		{
			"key": "roundUpId",
			"value": "",
			"type": "string"
		},
		{
			"key": "transactionId",
			"value": "YOUR_TRANSACTION_ID",
			"type": "string"
		},
		{
			"key": "testUserId",
			"value": "YOUR_TEST_USER_ID",
			"type": "string"
		},
		{
			"key": "newOrganizationId",
			"value": "YOUR_NEW_ORGANIZATION_ID",
			"type": "string"
		},
		{
			"key": "newCauseId",
			"value": "YOUR_NEW_CAUSE_ID",
			"type": "string"
		}
	]
}
