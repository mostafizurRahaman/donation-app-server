# Crescent Change API Documentation
# Version: 1.0.0
# Base URL: http://localhost:5001/api/v1

info:
  name: Crescent Change APIs
  description: Complete API collection for donation platform
  version: 1.0.0

variables:
  baseUrl: http://localhost:5001/api/v1
  accessToken: ""
  refreshToken: ""
  userId: ""
  organizationId: ""
  causeId: ""
  donationId: ""
  paymentMethodId: ""

# =============================================================================
# AUTHENTICATION ENDPOINTS
# =============================================================================

authentication:
  description: User authentication, registration, profile management
  
  endpoints:
    - name: Sign Up
      method: POST
      path: /auth/signup
      auth: false
      body:
        email: user@example.com
        password: SecurePass123!
      description: |
        Register new user. Password must be 8-20 characters with:
        - Uppercase letter
        - Lowercase letter
        - Number
        - Special character (@$!%*?&#)
      response:
        code: 201
        example:
          success: true
          message: OTP sent to your email successfully!
          data:
            _id: 64abc123def456
            email: user@example.com
            role: CLIENT
            isVerifiedByOTP: false

    - name: Resend Signup OTP
      method: POST
      path: /auth/send-signup-otp-again
      auth: false
      body:
        email: user@example.com

    - name: Verify Signup OTP
      method: POST
      path: /auth/verify-signup-otp
      auth: false
      body:
        email: user@example.com
        otp: "123456"
      description: Verify 6-digit OTP sent during signup

    - name: Sign In
      method: POST
      path: /auth/signin
      auth: false
      body:
        email: user@example.com
        password: SecurePass123!
      description: Sign in and receive access/refresh tokens
      response:
        code: 200
        example:
          success: true
          data:
            accessToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            refreshToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            user:
              _id: 64abc123
              email: user@example.com
              role: CLIENT

    - name: Create Profile (Client)
      method: POST
      path: /auth/create-Profile
      auth: true
      content_type: multipart/form-data
      body:
        role: CLIENT
        name: John Doe
        address: 123 Main Street
        state: NSW
        postalCode: "2000"
        nameInCard: John Doe
        cardNumber: "4242424242424242"
        cardExpiryDate: "2027-12-31"
        cardCVC: "123"
        clientImage: <file>
      description: Create client profile with payment details

    - name: Create Profile (Business)
      method: POST
      path: /auth/create-Profile
      auth: true
      content_type: multipart/form-data
      body:
        role: BUSINESS
        name: ABC Corporation
        category: Retail
        tagLine: Quality Products
        description: Leading retail business
        businessPhoneNumber: "+61234567890"
        businessEmail: contact@abc.com
        businessWebsite: https://abc.com
        locations: ["Sydney", "Melbourne"]
        businessImage: <file>

    - name: Create Profile (Organization)
      method: POST
      path: /auth/create-Profile
      auth: true
      content_type: multipart/form-data
      body:
        role: ORGANIZATION
        name: Hope Foundation
        serviceType: Education
        address: 456 Charity Street
        state: VIC
        postalCode: "3000"
        website: https://hopefoundation.org
        phoneNumber: "+61987654321"
        boardMemberName: Jane Smith
        boardMemberEmail: jane@hope.org
        boardMemberPhoneNumber: "+61987654322"
        tfnOrAbnNumber: "12345678901"
        zakatLicenseHolderNumber: ZL123456
        organizationImage: <file>

    - name: Update Photo
      method: PUT
      path: /auth/update-photo
      auth: true
      content_type: multipart/form-data
      body:
        profileImage: <file>

    - name: Change Password
      method: PATCH
      path: /auth/change-password
      auth: true
      body:
        oldPassword: SecurePass123!
        newPassword: NewSecurePass456!

    - name: Forgot Password
      method: POST
      path: /auth/forgot-password
      auth: false
      body:
        email: user@example.com
      description: Request password reset - sends OTP and returns token

    - name: Resend Forgot Password OTP
      method: POST
      path: /auth/send-forgot-password-otp-again
      auth: false
      body:
        token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    - name: Verify Forgot Password OTP
      method: POST
      path: /auth/verify-forgot-password-otp
      auth: false
      body:
        token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        otp: "123456"

    - name: Reset Password
      method: POST
      path: /auth/reset-password
      auth: false
      body:
        newPassword: NewSecurePass456!

    - name: Get Profile
      method: GET
      path: /auth/profile
      auth: true
      description: Get authenticated user's profile

    - name: Deactivate Account
      method: POST
      path: /auth/deactive-account
      auth: true
      body:
        email: user@example.com
        password: SecurePass123!
        deactivationReason: No longer using the service

    - name: Delete Account
      method: DELETE
      path: /auth/delete-account
      auth: true
      description: Permanently delete account

    - name: Refresh Access Token
      method: GET
      path: /auth/access-token
      auth: true
      headers:
        Cookie: refreshToken={{refreshToken}}

    - name: Update Auth Data
      method: PATCH
      path: /auth/update-auth-data
      auth: true
      body:
        name: Updated Name

# =============================================================================
# PAYMENT METHODS ENDPOINTS
# =============================================================================

payment_methods:
  description: Manage saved payment methods (cards) for donations
  
  endpoints:
    - name: Create Setup Intent
      method: POST
      path: /payment-method/setup-intent
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      body: {}
      description: |
        Create Stripe SetupIntent for card collection.
        Returns client_secret for frontend Stripe.js integration.
      response:
        code: 200
        example:
          success: true
          message: Setup intent created successfully for card payment!
          data:
            client_secret: seti_1234567890_secret_abcdefgh
            setup_intent_id: seti_1234567890

    - name: Add Payment Method
      method: POST
      path: /payment-method
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      body:
        stripePaymentMethodId: pm_1234567890abcdef
        cardHolderName: John Doe
        isDefault: true
      validation:
        - stripePaymentMethodId must start with 'pm_'
        - cardHolderName max 100 characters
      response:
        code: 201
        example:
          success: true
          data:
            _id: 64xyz123
            stripePaymentMethodId: pm_1234567890abcdef
            stripeCustomerId: cus_9876543210
            type: card
            cardBrand: visa
            cardLast4: "4242"
            cardExpMonth: 12
            cardExpYear: 2027
            isDefault: true
            isActive: true

    - name: Get User Payment Methods
      method: GET
      path: /payment-method
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      query_params:
        includeInactive: false
      description: Get all payment methods, sorted by default status

    - name: Get Default Payment Method
      method: GET
      path: /payment-method/default
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]

    - name: Get Payment Method by ID
      method: GET
      path: /payment-method/:id
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      params:
        id: Payment method ID

    - name: Set Default Payment Method
      method: PATCH
      path: /payment-method/:id/default
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      params:
        id: Payment method ID
      description: Set as default, unsets previous default

    - name: Delete Payment Method
      method: DELETE
      path: /payment-method/:id
      auth: true
      roles: [CLIENT, BUSINESS, ADMIN]
      params:
        id: Payment method ID
      description: Soft delete - marks as inactive, detaches from Stripe

# =============================================================================
# DONATIONS ENDPOINTS
# =============================================================================

donations:
  description: Create and manage donations with payment processing
  
  endpoints:
    - name: Create One-Time Donation
      method: POST
      path: /donation/one-time/create
      auth: true
      roles: [CLIENT]
      body:
        amount: 100
        currency: usd
        organizationId: 64org123
        causeId: 64cause456
        paymentMethodId: pm_1234567890abcdef
        specialMessage: Keep up the great work!
        connectedAccountId: acct_optional
      validation:
        - amount: $1 - $10,000
        - currency: 3 characters (e.g., USD)
        - paymentMethodId must start with 'pm_'
        - specialMessage max 500 characters
      description: |
        Create donation with direct payment using saved card.
        Payment processed immediately via Stripe Payment Intents.
        Returns donation record and payment details.
      response:
        code: 201
        example:
          success: true
          message: Donation created and payment initiated successfully
          data:
            donation:
              _id: 64don789
              amount: 100
              currency: USD
              status: processing
              pointsEarned: 10000
              stripePaymentIntentId: pi_1234567890
            payment:
              clientSecret: pi_1234567890_secret_xyz
              paymentIntentId: pi_1234567890
              status: processing

    - name: Process Payment for Donation
      method: POST
      path: /donation/:donationId/payment
      auth: true
      roles: [CLIENT]
      params:
        donationId: Donation ID
      body:
        successUrl: https://example.com/success
        cancelUrl: https://example.com/cancel
        paymentMethodType: card
      description: Process payment using Checkout Session (redirect flow)

    - name: Retry Failed Payment
      method: POST
      path: /donation/:donationId/retry
      auth: true
      roles: [CLIENT]
      params:
        donationId: Failed donation ID
      description: Retry failed payment (max 3 attempts)

    - name: Get Donation Full Status
      method: GET
      path: /donation/:id/status
      auth: true
      roles: [CLIENT, ADMIN, ORGANIZATION]
      params:
        id: Donation ID
      description: Get donation with payment status and retry info
      response:
        code: 200
        example:
          data:
            donation:
              _id: 64don789
              amount: 100
              status: completed
            paymentStatus:
              status: completed
              paymentAttempts: 1
              canRetry: false
              paymentIntentId: pi_1234567890

    - name: Get User Donations
      method: GET
      path: /donation/user
      auth: true
      roles: [CLIENT, ADMIN]
      query_params:
        page: 1
        limit: 10
        status: all  # all, pending, completed, failed, refunded
        donationType: all  # all, one-time, recurring, round-up
      description: Get paginated user donations with filters
      response:
        code: 200
        example:
          data:
            donations: []
            total: 25
            page: 1
            totalPages: 3

    - name: Get Donation by ID
      method: GET
      path: /donation/:id
      auth: true
      roles: [CLIENT, ADMIN, ORGANIZATION]
      params:
        id: Donation ID

    - name: Get Organization Donations
      method: GET
      path: /donation/organization/:organizationId
      auth: true
      roles: [ORGANIZATION, ADMIN]
      params:
        organizationId: Organization ID
      query_params:
        page: 1
        limit: 10
        status: all
        type: all

# =============================================================================
# CAUSES ENDPOINTS
# =============================================================================

causes:
  description: Manage donation causes for organizations
  
  endpoints:
    - name: Get Cause Names
      method: GET
      path: /cause/names
      auth: false
      description: Public endpoint for cause names dropdown

    - name: Create Cause
      method: POST
      path: /cause
      auth: true
      roles: [ORGANIZATION, ADMIN]
      body:
        name: Education for All
        description: Providing quality education
        organizationId: 64org123
        targetAmount: 50000
        category: Education
        imageUrl: https://example.com/image.jpg
        isActive: true

    - name: Get All Causes
      method: GET
      path: /cause
      auth: false
      query_params:
        page: 1
        limit: 10
        category: ""
        search: ""
      description: Public endpoint with pagination and filters

    - name: Get Causes by Organization
      method: GET
      path: /cause/organization/:organizationId
      auth: false
      params:
        organizationId: Organization ID
      description: Public endpoint for organization causes

    - name: Get Cause by ID
      method: GET
      path: /cause/:id
      auth: false
      params:
        id: Cause ID
      description: Public endpoint for cause details

    - name: Update Cause
      method: PATCH
      path: /cause/:id
      auth: true
      roles: [ORGANIZATION, ADMIN]
      params:
        id: Cause ID
      body:
        name: Updated Name
        description: Updated description
        targetAmount: 75000

    - name: Delete Cause
      method: DELETE
      path: /cause/:id
      auth: true
      roles: [ORGANIZATION, ADMIN]
      params:
        id: Cause ID

# =============================================================================
# STRIPE ENDPOINTS
# =============================================================================

stripe:
  description: Stripe payment integration
  
  endpoints:
    - name: Create Checkout Session
      method: POST
      path: /stripe/checkout-session
      auth: true
      body:
        amount: 100
        causeId: 64cause456
        organizationId: 64org123
        userId: 64user123
        connectedAccountId: acct_optional
        specialMessage: Thank you!
      description: Create Checkout Session for redirect payment flow
      response:
        code: 200
        example:
          data:
            sessionId: cs_test_1234567890
            url: https://checkout.stripe.com/pay/cs_test_1234567890

    - name: Retrieve Checkout Session
      method: GET
      path: /stripe/checkout-session/:sessionId
      auth: true
      params:
        sessionId: Stripe session ID

    - name: Create Refund
      method: POST
      path: /stripe/refund
      auth: true
      body:
        paymentIntentId: pi_1234567890
        amount: 50
        reason: requested_by_customer
      description: Create full or partial refund

# =============================================================================
# ROLES & PERMISSIONS
# =============================================================================

roles:
  CLIENT: Regular user who can make donations
  BUSINESS: Business account
  ORGANIZATION: Non-profit organization receiving donations
  ADMIN: Platform administrator

# =============================================================================
# VALIDATION RULES
# =============================================================================

validation_rules:
  password:
    - length: 8-20 characters
    - uppercase: required
    - lowercase: required
    - number: required
    - special_char: required (@$!%*?&#)
  
  email:
    - format: valid email
    - case: converted to lowercase
  
  otp:
    - length: exactly 6 digits
    - type: numeric
  
  donation_amount:
    - min: $1
    - max: $10,000
  
  special_message:
    - max_length: 500 characters

# =============================================================================
# STATUS VALUES
# =============================================================================

status_values:
  donation_status:
    - pending: Initial state, awaiting payment
    - processing: Payment being processed by Stripe
    - completed: Payment successful
    - failed: Payment failed
    - refunded: Payment refunded
  
  donation_type:
    - one-time: Single donation
    - recurring: Scheduled recurring donation
    - round-up: Automatic round-up donation

# =============================================================================
# ERROR CODES
# =============================================================================

error_responses:
  400: Bad Request - Invalid input
  401: Unauthorized - Missing or invalid token
  403: Forbidden - Insufficient permissions
  404: Not Found - Resource not found
  409: Conflict - Resource already exists
  500: Internal Server Error

# =============================================================================
# POINTS SYSTEM
# =============================================================================

points:
  calculation: 100 points per dollar donated
  example: $100 donation = 10,000 points

# =============================================================================
# STRIPE TEST CARDS
# =============================================================================

test_cards:
  success: "4242 4242 4242 4242"
  decline: "4000 0000 0000 0002"
  auth_required: "4000 0025 0000 3155"
  expired: "4000 0000 0000 0069"
